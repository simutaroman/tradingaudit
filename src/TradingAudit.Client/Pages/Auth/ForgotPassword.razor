@page "/forgot-password"
@inject IAuthService AuthService
@inject ISnackbar Snackbar

<MudContainer MaxWidth="MaxWidth.Small" Class="mt-16">
    <MudPaper Class="pa-8">
        <MudText Typo="Typo.h5" Align="Align.Center" GutterBottom="true">Відновлення пароля</MudText>

        <MudForm @ref="_form">
            <MudTextField T="string" Label="Email" @bind-Value="_email"
                          InputType="InputType.Email" Required="true"
                          Variant="Variant.Outlined" Class="mb-4" />

            <MudButton Variant="Variant.Filled" Color="Color.Primary" FullWidth="true"
                       OnClick="SubmitAsync" Disabled="_isLoading">
                @if (_isLoading)
                {
                    <MudProgressCircular Size="Size.Small" Indeterminate="true" />
                }
                else
                {

                    <MudText>Надіслати код</MudText>
                }
            </MudButton>
        </MudForm>
    </MudPaper>
</MudContainer>

@code {
    private string _email = "";
    private bool _isLoading = false;
    private MudForm _form;

    private async Task SubmitAsync()
    {
        await _form.Validate();
        if (!_form.IsValid) return;

        _isLoading = true;

        // Викликаємо наш сервіс
        var success = await AuthService.ForgotPasswordAsync(_email);

        _isLoading = false;

        if (success)
        {
            Snackbar.Add("Якщо email існує, ми надіслали інструкції.", Severity.Success);
        }
        else
        {
            Snackbar.Add("Помилка при відправці.", Severity.Error);
        }
    }
}